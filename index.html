<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO (Search Engine Optimization) Tags -->
    <title>Nabila Studio - AI Creative Suite (Novel, Podcast, Lirik & Lainnya)</title>
    <meta name="description" content="Selamat datang di Nabila Studio. Suite AI lengkap untuk menulis novel (Cohere), membuat podcast (ElevenLabs, Pixabay), lirik lagu, puisi, dan alat kreatif lainnya.">
    <meta name="keywords" content="AI, Nabila Studio, AI Novel Writer, Podcast Generator, Lyric Generator, Poem Generator, Cohere, ElevenLabs, Pixabay, Penulis, Podcaster, Kreator, Kecerdasan Buatan">
    <meta name="author" content="Nabila Studio Development">
    <meta name="robots" content="index, follow">

    <!-- Favicon -->
    <link rel="icon" href="https://img.icons8.com/fluency/48/prototyping-process.png" type="image/png">

    <!-- Google Fonts & Font Awesome Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Orbitron:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SweetAlert2 for beautiful pop-ups -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --bg-dark: #10101a;
            --bg-light: #1d1d2b;
            --sidebar-bg: #151521;
            --primary-glow: #a855f7;
            --secondary-glow: #00e1ff;
            --accent-glow: #ff55a5;
            --text-light: #f0f0f0;
            --text-dark: #a0a0b0;
            --border-color: rgba(255, 255, 255, 0.1);
            --warning-color: #ffc107;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            background-image: radial-gradient(circle at 1% 1%, var(--primary-glow), transparent 30%),
                              radial-gradient(circle at 99% 99%, var(--secondary-glow), transparent 30%),
                              radial-gradient(circle at 50% 50%, var(--accent-glow), transparent 40%);
            background-attachment: fixed;
            overflow-x: hidden;
        }

        .page-wrapper { display: flex; }
        .sidebar {
            width: 260px; background-color: var(--sidebar-bg); position: fixed;
            top: 0; left: 0; height: 100vh; padding: 1.5rem 1rem;
            border-right: 1px solid var(--border-color); display: flex;
            flex-direction: column; z-index: 100;
        }
        .sidebar-header { text-align: center; margin-bottom: 2rem; }
        .sidebar-header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 1.5em;
            background: linear-gradient(90deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .sidebar-header h1 i { display: block; margin-bottom: 0.5rem; font-size: 2em; }
        .sidebar-nav a {
            display: flex; align-items: center; padding: 1rem; margin-bottom: 0.5rem;
            color: var(--text-dark); text-decoration: none; border-radius: 8px;
            font-weight: 600; transition: all 0.3s ease;
        }
        .sidebar-nav a i { width: 30px; font-size: 1.2em; margin-right: 1rem; }
        .sidebar-nav a:hover { background-color: var(--bg-light); color: var(--text-light); }
        .sidebar-nav a.active { background-color: var(--bg-light); color: var(--text-light); box-shadow: 0 0 15px var(--primary-glow); }

        .main-content-area { margin-left: 260px; width: calc(100% - 260px); padding: 2rem; animation: fadeIn 1s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .page { display: none; }
        .page.active { display: block; animation: contentFadeIn 0.5s; }
        @keyframes contentFadeIn { from { opacity: 0; } to { opacity: 1; } }

        .page-header { margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .page-header h2 { font-size: 2.2em; font-weight: 700; }
        .page-header p { color: var(--text-dark); }
        
        .form-section { background-color: var(--bg-light); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border: 1px solid var(--border-color); }
        .form-section h3 { font-size: 1.5em; margin-bottom: 1rem; border-left: 4px solid var(--primary-glow); padding-left: 10px; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark); }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; padding: 0.8rem; background-color: var(--bg-dark); border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-light); font-size: 1em; transition: all 0.3s ease;
        }
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus { outline: none; border-color: var(--secondary-glow); box-shadow: 0 0 10px var(--secondary-glow); }
        textarea { resize: vertical; min-height: 120px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
        .btn {
            display: inline-block; padding: 1rem; font-size: 1.2em; font-weight: 700; text-align: center;
            border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
        }
        .btn-primary { background: linear-gradient(90deg, var(--primary-glow), var(--accent-glow)); color: white; width: 100%;}
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); }
        .btn:disabled { background: var(--text-dark); cursor: not-allowed; }

        .output-pane { margin-top: 2rem; }
        .output-pane h3 { font-size: 1.5em; margin-bottom: 1rem; border-left: 4px solid var(--secondary-glow); padding-left: 10px; }
        .output-area { width: 100%; min-height: 400px; background-color: #10101a; color: #f0f0f0; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; font-size: 1.1em; line-height: 1.6; }
        .action-buttons { display: flex; gap: 1rem; margin-top: 1rem; }

        .disclaimer-box {
            padding: 1rem; background-color: rgba(255, 193, 7, 0.1); border-left: 5px solid var(--warning-color);
            border-radius: 8px; margin-bottom: 1.5rem; color: var(--warning-color);
        }
        .disclaimer-box h4 { margin-bottom: 0.5rem; }
        .disclaimer-box p { color: #f0f0f0; }

        .whatsapp-fab {
            position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white;
            width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 2em; text-decoration: none;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); transition: all 0.3s ease; z-index: 100;
        }
        .whatsapp-fab:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6); }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); position: fixed; }
            .main-content-area { margin-left: 0; width: 100%; }
            .sidebar.open { transform: translateX(0); }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="page-wrapper">
        <nav class="sidebar">
            <div class="sidebar-header"><h1><i class="fa-solid fa-brain"></i>Nabila Studio</h1></div>
            <div class="sidebar-nav">
                <a href="#" class="nav-link active" data-page="page-dashboard"><i class="fa-solid fa-house-chimney"></i> Dashboard</a>
                <a href="#" class="nav-link" data-page="page-writer"><i class="fa-solid fa-book-sparkles"></i> AI Novel Writer</a>
                <a href="#" class="nav-link" data-page="page-podcast"><i class="fa-solid fa-podcast"></i> Studio Podcast</a>
                <a href="#" class="nav-link" data-page="page-lyrics"><i class="fa-solid fa-music"></i> Generator Lirik</a>
                <a href="#" class="nav-link" data-page="page-poem"><i class="fa-solid fa-feather-alt"></i> Generator Puisi</a>
                <a href="#" class="nav-link" data-page="page-togel"><i class="fa-solid fa-chart-line"></i> Konsultan Prediksi</a>
                <a href="#" class="nav-link" data-page="page-keys"><i class="fa-solid fa-key"></i> Manajemen Kunci API</a>
            </div>
        </nav>

        <main class="main-content-area">
            
            <div id="page-dashboard" class="page active">
                <div class="page-header"><h2>Dashboard</h2><p>Selamat datang kembali, Kreator! Inilah pusat kendali kreatif Anda.</p></div>
                <div class="form-section"><h3><i class="fa-solid fa-rocket"></i> Akses Cepat</h3><div class="grid">
                    <button class="btn" onclick="navigateToPage('page-writer')">Mulai Menulis Novel</button>
                    <button class="btn" onclick="navigateToPage('page-podcast')">Buat Podcast AI</button>
                    <button class="btn" onclick="navigateToPage('page-lyrics')">Ciptakan Lirik Lagu</button>
                </div></div>
            </div>

            <div id="page-writer" class="page">
                <div class="page-header"><h2>AI Novel Writer</h2><p>Wujudkan dunia fiksi Anda dengan gaya novelis profesional.</p></div>
                <form id="novel-form">
                    <div class="form-section">
                        <h3><i class="fa-solid fa-feather-pointed"></i> Deskripsi Novel Anda</h3>
                        <div class="input-group">
                            <label for="novel-desc">Jelaskan ide novel Anda secara detail. Sebutkan protagonis, konflik utama, setting, dan nuansa yang Anda inginkan. AI akan menggunakan ini untuk menulis bab pertama.</label>
                            <textarea id="novel-desc" placeholder="Contoh: Sebuah cerita roman suspense di Bali. Seorang detektif wanita tangguh bernama Rania harus bekerja sama dengan mantan kekasihnya, seorang pengusaha misterius bernama Dimitri, untuk memecahkan kasus pembunuhan berantai yang mengancam industri pariwisata. Ada ketegangan, gairah terlarang, dan konspirasi besar di baliknya..." style="min-height: 200px;"></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="generate-novel-btn"><i class="fa-solid fa-wand-magic-sparkles"></i> Tulis Bab <span id="chapter-number-display">1</span>!</button>
                </form>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-file-alt"></i> Naskah Novel</h3>
                    <textarea id="novel-output-area" class="output-area" readonly placeholder="Hasil tulisan AI akan muncul di sini..."></textarea>
                    <div class="action-buttons">
                        <button class="btn" id="next-chapter-btn" style="display: none; background: #007bff; color: white;"><i class="fa-solid fa-plus-circle"></i> Tulis Bab Selanjutnya</button>
                        <button class="btn" id="save-chapter-btn" style="display: none; background: #6c757d; color: white;"><i class="fa-solid fa-save"></i> Simpan Bab Ini (.txt)</button>
                    </div>
                </div>
            </div>
            
            <div id="page-podcast" class="page">
                <div class="page-header"><h2>Studio Podcast AI</h2><p>Hasilkan naskah dan audio podcast lengkap dengan musik dan efek suara.</p></div>
                <div class="grid">
                    <div class="form-section">
                        <h3><i class="fa-solid fa-file-lines"></i> 1. Buat Naskah Podcast</h3>
                        <div class="input-group">
                            <label for="podcast-topic">Topik Podcast</label>
                            <textarea id="podcast-topic" placeholder="Contoh: Kisah sukses membangun startup dari nol, misteri segitiga bermuda, tips & trik public speaking..."></textarea>
                        </div>
                        <button class="btn btn-primary" id="generate-script-btn"><i class="fa-solid fa-pen-nib"></i> Hasilkan Naskah</button>
                    </div>
                    <div class="form-section">
                        <h3><i class="fa-solid fa-microphone-lines"></i> 2. Hasilkan Audio</h3>
                         <div class="input-group">
                            <label for="podcast-host-voice">Pilih Suara Host</label>
                            <select id="podcast-host-voice">
                                <option value="21m00Tcm4TlvDq8ikWAM">Rachel (Wanita, Tenang)</option>
                                <option value="ErXwobaYiN019PkySvjV">Antoni (Pria, Profesional)</option>
                                <option value="2EiwWnXFnvU5JabPnv8n">Clyde (Pria, Dalam)</option>
                            </select>
                        </div>
                         <div class="input-group">
                            <label for="podcast-guest-voice">Pilih Suara Guest</label>
                            <select id="podcast-guest-voice">
                                 <option value="MF3mGyEYCl7XYWbV9V6O">Elli (Wanita, Emosional)</option>
                                 <option value="AZnzlk1XvdvUeBnXmlld">Domi (Wanita, Muda)</option>
                                 <option value="EXAVITQu4vr4xnSDxMaL">Bella (Wanita, Lembut)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="podcast-music">Musik Latar (dari Pixabay)</label>
                            <input type="text" id="podcast-music-query" placeholder="Contoh: lofi chill, uplifting corporate">
                        </div>
                        <button class="btn btn-primary" id="generate-audio-btn" disabled><i class="fa-solid fa-play-circle"></i> Hasilkan Audio Podcast</button>
                    </div>
                </div>
                 <div class="output-pane">
                    <h3><i class="fa-solid fa-file-alt"></i> Naskah & Hasil Audio</h3>
                    <textarea id="podcast-script-output" class="output-area" readonly placeholder="Naskah yang dihasilkan akan muncul di sini..."></textarea>
                    <div id="podcast-audio-result" style="margin-top: 1.5rem;"></div>
                    <div class="disclaimer-box" style="margin-top: 1rem; display: none;" id="podcast-disclaimer">
                        <h4>Simulasi Audio Studio</h4>
                        <p>Audio host, guest, dan musik latar diputar bersamaan untuk simulasi. Untuk produksi final, unduh setiap file audio secara terpisah dan gabungkan menggunakan software editing audio.</p>
                    </div>
                </div>
            </div>

            <div id="page-lyrics" class="page">
                <div class="page-header"><h2>Generator Lirik Lagu</h2><p>Ciptakan lirik yang puitis dan emosional dari ide Anda.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-lightbulb"></i> Tema Lagu Anda</h3>
                    <div class="input-group">
                        <label for="lyrics-prompt">Jelaskan tema, genre, dan perasaan yang ingin Anda sampaikan dalam lagu.</label>
                        <textarea id="lyrics-prompt" placeholder="Contoh: Lagu pop ballad tentang kerinduan pada sahabat lama, lagu rock tentang semangat pantang menyerah, lagu folk tentang keindahan senja di desa..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="generateGeneric('lyrics')"><i class="fa-solid fa-microphone-alt"></i> Buat Lirik!</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-file-music"></i> Hasil Lirik</h3>
                    <textarea id="lyrics-output" class="output-area" readonly placeholder="Lirik lagu akan muncul di sini..."></textarea>
                </div>
            </div>

            <div id="page-poem" class="page">
                <div class="page-header"><h2>Generator Puisi</h2><p>Sulap kata-kata menjadi untaian puisi yang menyentuh jiwa.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-feather-alt"></i> Inspirasi Puisi Anda</h3>
                    <div class="input-group">
                        <label for="poem-prompt">Tuliskan tentang apa puisi yang Anda inginkan.</label>
                        <textarea id="poem-prompt" placeholder="Contoh: Hujan di bulan Juni, secangkir kopi di pagi hari, riuh pasar malam, kesendirian di tengah kota..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="generateGeneric('poem')"><i class="fa-solid fa-pen-fancy"></i> Tulis Puisi!</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-book-open-reader"></i> Hasil Puisi</h3>
                    <textarea id="poem-output" class="output-area" readonly placeholder="Puisi akan muncul di sini..."></textarea>
                </div>
            </div>

             <div id="page-togel" class="page">
                <div class="page-header"><h2>Konsultan Prediksi (Hanya Hiburan)</h2><p>Dapatkan interpretasi kreatif dan narasi fiksi berdasarkan data.</p></div>
                <div class="disclaimer-box">
                    <h4><i class="fa-solid fa-triangle-exclamation"></i> PERINGATAN PENTING</h4>
                    <p>Alat ini adalah untuk <strong>tujuan hiburan semata</strong>. Hasil yang diberikan adalah <strong>fiksi</strong>, berupa analisis puitis dan cerita kreatif berdasarkan prompt Anda. Ini <strong>BUKAN alat judi</strong> dan tidak ada jaminan keakuratan apa pun. Gunakan dengan bijak dan bertanggung jawab.</p>
                </div>
                 <div class="form-section">
                    <h3><i class="fa-solid fa-lightbulb"></i> Prompt Konsultasi Anda</h3>
                    <div class="input-group">
                        <label for="togel-prompt">Masukkan prompt untuk analisis kreatif (Contoh: "Pasaran Hongkong", "Pasaran Singapura"). AI akan memberikan narasi fiksi, bukan angka.</label>
                        <textarea id="togel-prompt" placeholder="Contoh: Buatkan analisis puitis tentang pergerakan bintang untuk pasaran Hongkong malam ini. Tema: Naga Air."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="generateGeneric('togel')"><i class="fa-solid fa-brain-circuit"></i> Beri Saya Interpretasi Fiksi</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-scroll"></i> Hasil Interpretasi Fiksi</h3>
                    <textarea id="togel-output" class="output-area" readonly placeholder="Narasi fiksi dan interpretasi kreatif akan muncul di sini..."></textarea>
                </div>
            </div>

            <div id="page-keys" class="page">
                <div class="page-header"><h2>Manajemen Kunci API</h2><p>Masukkan semua kunci API Anda di sini untuk mengaktifkan semua fitur.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-key"></i> Kunci API Anda</h3>
                     <div class="grid">
                        <div class="input-group">
                            <label for="cohere-key">Kunci API Cohere (Untuk Novel, Podcast, Lirik, dll.)</label>
                            <input type="password" id="cohere-key" placeholder="Wajib untuk generasi teks">
                        </div>
                        <div class="input-group">
                            <label for="elevenlabs-key">Kunci API ElevenLabs (Untuk Podcast)</label>
                            <input type="password" id="elevenlabs-key" placeholder="Wajib untuk generasi suara">
                        </div>
                         <div class="input-group">
                            <label for="pixabay-key">Kunci API Pixabay (Untuk Musik Latar Podcast)</label>
                            <input type="password" id="pixabay-key" placeholder="Wajib untuk musik latar">
                        </div>
                     </div>
                     <button class="btn" id="save-keys-btn" style="width: auto; padding: 0.8rem 1.5rem;"><i class="fa-solid fa-save"></i> Simpan Semua Kunci</button>
                </div>
            </div>

        </main>
    </div>

    <a href="https://wa.me/6285810526151?text=Halo%20Admin%20Nabila%20Studio" target="_blank" class="whatsapp-fab"><i class="fab fa-whatsapp"></i></a>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- GLOBAL DOM ELEMENTS ---
        const dom = {
            navLinks: document.querySelectorAll('.nav-link'),
            cohereKeyInput: document.getElementById('cohere-key'),
            elevenlabsKeyInput: document.getElementById('elevenlabs-key'),
            pixabayKeyInput: document.getElementById('pixabay-key'),
            saveKeysBtn: document.getElementById('save-keys-btn'),
            // Novel
            novelForm: document.getElementById('novel-form'),
            novelOutputArea: document.getElementById('novel-output-area'),
            generateNovelBtn: document.getElementById('generate-novel-btn'),
            chapterNumberDisplay: document.getElementById('chapter-number-display'),
            nextChapterBtn: document.getElementById('next-chapter-btn'),
            saveChapterBtn: document.getElementById('save-chapter-btn'),
            // Podcast
            generateScriptBtn: document.getElementById('generate-script-btn'),
            generateAudioBtn: document.getElementById('generate-audio-btn'),
            podcastScriptOutput: document.getElementById('podcast-script-output'),
            podcastAudioResult: document.getElementById('podcast-audio-result'),
            podcastDisclaimer: document.getElementById('podcast-disclaimer'),
        };

        // --- GLOBAL APP STATE ---
        let state = {
            story: { fullStoryContext: "", currentChapterNumber: 1, isGenerating: false },
            podcast: { script: "", isGenerating: false }
        };

        // --- INITIALIZATION ---
        loadApiKeys();
        
        // --- EVENT LISTENERS ---
        dom.navLinks.forEach(link => link.addEventListener('click', e => { e.preventDefault(); navigateToPage(link.dataset.page, link); }));
        dom.saveKeysBtn.addEventListener('click', saveApiKeys);
        
        // Novel Listeners
        dom.novelForm.addEventListener('submit', e => { e.preventDefault(); generateNovelChapter(); });
        dom.nextChapterBtn.addEventListener('click', generateNovelChapter);
        dom.saveChapterBtn.addEventListener('click', saveChapterToFile);

        // Podcast Listeners
        dom.generateScriptBtn.addEventListener('click', generatePodcastScript);
        dom.generateAudioBtn.addEventListener('click', generatePodcastAudio);

        // --- KEY MANAGEMENT ---
        function loadApiKeys() {
            dom.cohereKeyInput.value = localStorage.getItem('cohereApiKey') || '';
            dom.elevenlabsKeyInput.value = localStorage.getItem('elevenlabsApiKey') || '';
            dom.pixabayKeyInput.value = localStorage.getItem('pixabayApiKey') || '';
        }
        function saveApiKeys() {
            localStorage.setItem('cohereApiKey', dom.cohereKeyInput.value);
            localStorage.setItem('elevenlabsApiKey', dom.elevenlabsKeyInput.value);
            localStorage.setItem('pixabayApiKey', dom.pixabayKeyInput.value);
            Swal.fire('Sukses', 'Semua Kunci API telah disimpan di browser Anda.', 'success');
        }
        function getApiKey(service) {
            const key = localStorage.getItem(`${service}ApiKey`);
            if (!key) {
                Swal.fire('Kunci API Hilang', `Harap masukkan Kunci API untuk ${service} di halaman 'Manajemen Kunci API'.`, 'error');
                navigateToPage('page-keys');
                return null;
            }
            return key;
        }
        
        // --- NAVIGATION ---
        window.navigateToPage = function(pageId, clickedLink = null) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const linkToActivate = clickedLink || document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (linkToActivate) linkToActivate.classList.add('active');
        }

        // --- HELPER: API CALL FUNCTION ---
        async function makeApiCall(url, options, loadingMessage) {
            Swal.fire({ title: 'Sedang Memproses...', html: loadingMessage, allowOutsideClick: false, didOpen: () => Swal.showLoading() });
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }
                Swal.close();
                return response;
            } catch (error) {
                console.error("API Call Error:", error);
                Swal.fire('Terjadi Kesalahan', `Gagal menghubungi API. Detail: ${error.message}`, 'error');
                return null;
            }
        }
        
        // --- NOVEL WRITER LOGIC ---
        function buildNovelPrompt() {
            const novelDesc = document.getElementById('novel-desc').value;
            const preamble = `Anda adalah seorang novelis ahli kelas dunia bernama Nabila, yang menggabungkan gaya penceritaan Sandra Brown yang penuh ketegangan dan romansa dengan gaya Enny Arrow yang sensual dan berani. Anda menulis dalam Bahasa Indonesia yang baku, indah, dan sangat deskriptif. Anda TIDAK PERNAH menulis ulang instruksi prompt dalam jawaban Anda. Anda langsung menulis narasinya. Setiap bab yang Anda hasilkan HARUS dan WAJIB memiliki panjang antara 5000 hingga 6000 kata untuk memenuhi standar Goodnovel, Fizzo, dan Noveltoon.`;
            
            let message;
            if (state.story.currentChapterNumber > 1 && state.story.fullStoryContext) {
                message = `Berikut adalah ringkasan dari bab-bab sebelumnya:\n<konteks>\n${state.story.fullStoryContext}\n</konteks>\n\nSekarang, lanjutkan cerita dengan menulis **Bab ${state.story.currentChapterNumber}** secara lengkap dan mendetail. Pastikan transisi dari bab sebelumnya mulus dan alur cerita terus berkembang secara dramatis. Ingat, target panjang bab ini adalah 5000-6000 kata. Mulai langsung dengan judul bab atau narasi.`;
            } else {
                message = `Anda akan menulis sebuah novel berdasarkan deskripsi berikut: "${novelDesc}".\n\nTugas Anda adalah menulis **Bab 1** dari novel ini. Buatlah awal yang sangat menarik, perkenalkan karakter dan konflik utama secara organik, dan bangun suasana yang kuat sesuai deskripsi. Ingat, target panjang bab ini adalah 5000-6000 kata. Mulai langsung dengan judul bab atau narasi.`;
            }
            return { preamble, message };
        }

        async function generateNovelChapter() {
            if (state.story.isGenerating) return;
            const cohereKey = getApiKey('cohere');
            if (!cohereKey) return;
            if (state.story.currentChapterNumber === 1 && !document.getElementById('novel-desc').value) {
                Swal.fire('Input Kosong', 'Harap isi deskripsi novel terlebih dahulu.', 'warning');
                return;
            }

            state.story.isGenerating = true;
            dom.generateNovelBtn.disabled = true;
            dom.nextChapterBtn.disabled = true;
            dom.generateNovelBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Menulis Bab ${state.story.currentChapterNumber}...`;

            const { preamble, message } = buildNovelPrompt();
            dom.novelOutputArea.value = `Menghubungi AI Cohere untuk menulis Bab ${state.story.currentChapterNumber}...\nMohon tunggu, proses ini mungkin memakan waktu beberapa menit karena permintaan kata yang panjang.`;

            try {
                const response = await fetch("https://api.cohere.com/v1/chat", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${cohereKey}` },
                    body: JSON.stringify({ message, preamble, stream: true }),
                });

                if (!response.ok) { const errorText = await response.text(); throw new Error(`API Error: ${response.status} - ${errorText}`); }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                dom.novelOutputArea.value = ""; // Clear placeholder text

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value, { stream: true });
                    try {
                        const lines = chunk.split('\n');
                        lines.forEach(line => {
                            if (line.trim().startsWith('{')) {
                                const parsed = JSON.parse(line);
                                if (parsed.event_type === "text-generation" && parsed.text) {
                                    dom.novelOutputArea.value += parsed.text;
                                    dom.novelOutputArea.scrollTop = dom.novelOutputArea.scrollHeight;
                                }
                            }
                        });
                    } catch (e) { /* Incomplete JSON chunk */ }
                }
                
                // After generation is complete
                const currentContent = dom.novelOutputArea.value;
                state.story.fullStoryContext += `\n\n--- Ringkasan Bab ${state.story.currentChapterNumber} ---\n` + currentContent.substring(0, 1000) + '...';
                state.story.currentChapterNumber++;

            } catch (error) {
                console.error("Cohere Streaming error:", error);
                Swal.fire('Streaming Error', error.message, 'error');
                dom.novelOutputArea.value = `Terjadi kesalahan: ${error.message}`;
            } finally {
                state.story.isGenerating = false;
                dom.generateNovelBtn.disabled = false;
                dom.generateNovelBtn.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles"></i> Tulis Bab 1!`;
                dom.chapterNumberDisplay.textContent = state.story.currentChapterNumber;
                dom.nextChapterBtn.style.display = 'block';
                dom.saveChapterBtn.style.display = 'block';
                dom.nextChapterBtn.disabled = false;
            }
        }
        
        function saveChapterToFile() {
            const content = dom.novelOutputArea.value;
            if (!content) return;
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Bab_${state.story.currentChapterNumber - 1}_Novel_NabilaStudio.txt`;
            link.click();
        }

        // --- PODCAST STUDIO LOGIC ---
        async function generatePodcastScript() {
            const cohereKey = getApiKey('cohere');
            const topic = document.getElementById('podcast-topic').value;
            if (!cohereKey || !topic) {
                Swal.fire('Input Tidak Lengkap', 'Harap masukkan Kunci API Cohere dan Topik Podcast.', 'warning');
                return;
            }

            const preamble = "Anda adalah seorang penulis naskah podcast profesional. Anda membuat dialog yang alami, menarik, dan informatif antara seorang HOST dan seorang GUEST. Selalu format naskah dengan 'HOST:' dan 'GUEST:' di awal setiap baris dialog.";
            const message = `Tulis naskah podcast lengkap tentang topik: "${topic}". Buatlah percakapan yang mengalir, dengan pertanyaan mendalam dari host dan jawaban yang berwawasan dari guest.`;
            
            const response = await makeApiCall("https://api.cohere.com/v1/chat", {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${cohereKey}` },
                body: JSON.stringify({ message, preamble }),
            }, 'AI sedang menulis naskah podcast...');

            if (response) {
                const data = await response.json();
                state.podcast.script = data.text;
                dom.podcastScriptOutput.value = state.podcast.script;
                dom.generateAudioBtn.disabled = false;
                Swal.fire('Sukses!', 'Naskah podcast berhasil dibuat. Sekarang Anda bisa menghasilkan audionya.', 'success');
            }
        }
        
        async function generatePodcastAudio() {
            const elevenlabsKey = getApiKey('elevenlabs');
            const pixabayKey = getApiKey('pixabay');
            if (!elevenlabsKey || !pixabayKey || !state.podcast.script) {
                Swal.fire('Input Tidak Lengkap', 'Pastikan Kunci API ElevenLabs & Pixabay tersedia dan naskah sudah dibuat.', 'warning');
                return;
            }
            
            Swal.fire({ title: 'Mempersiapkan Audio Studio...', html: 'Mengambil musik latar dan memproses suara...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            dom.podcastAudioResult.innerHTML = '';
            dom.podcastDisclaimer.style.display = 'none';

            try {
                // 1. Fetch Background Music
                const musicQuery = document.getElementById('podcast-music-query').value || 'lofi background';
                const musicResponse = await fetch(`https://pixabay.com/api/music/?key=${pixabayKey}&q=${encodeURIComponent(musicQuery)}&per_page=3`);
                const musicData = await musicResponse.json();
                let musicUrl = null;
                if (musicData.hits && musicData.hits.length > 0) {
                    musicUrl = musicData.hits[0].previewURL;
                } else {
                    console.warn("No background music found for query.");
                }

                // 2. Parse script and generate voices
                const lines = state.podcast.script.split('\n').filter(line => line.trim() !== '');
                const voicePromises = lines.map(line => {
                    const isHost = line.trim().toUpperCase().startsWith('HOST:');
                    const isGuest = line.trim().toUpperCase().startsWith('GUEST:');
                    
                    if (isHost || isGuest) {
                        const voiceId = isHost ? document.getElementById('podcast-host-voice').value : document.getElementById('podcast-guest-voice').value;
                        const text = line.replace(/^(HOST:|GUEST:)\s*/i, '').trim();
                        const url = `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`;
                        return fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'Accept': 'audio/mpeg', 'xi-api-key': elevenlabsKey },
                            body: JSON.stringify({ text, model_id: 'eleven_multilingual_v2', voice_settings: { stability: 0.5, similarity_boost: 0.75 } }),
                        }).then(res => res.blob()).then(blob => URL.createObjectURL(blob));
                    }
                    return Promise.resolve(null); // Not a dialogue line
                });
                
                const audioUrls = await Promise.all(voicePromises);
                Swal.close();

                // 3. Render Player
                let html = '<h4><i class="fa-solid fa-headphones"></i> Pemutar Podcast</h4>';
                
                if (musicUrl) {
                    html += `
                        <div style="margin-bottom: 1rem;">
                            <label>Musik Latar:</label>
                            <audio id="bg-music-player" controls loop src="${musicUrl}" style="width: 100%;"></audio>
                            <a href="${musicUrl}" download="background-music.mp3" class="btn" style="width:auto; padding: 5px 10px; font-size: 0.8em; margin-top: 5px;">Unduh Musik</a>
                        </div>
                    `;
                }

                const dialoguePlayerHtml = audioUrls.map((url, index) => {
                    if (url) {
                        const lineText = lines[index];
                        return `
                            <div style="margin-bottom: 0.5rem;">
                                <p style="font-weight: bold; color: var(--text-dark);">${lineText.split(':')[0]}:</p>
                                <audio controls src="${url}" style="width: 100%;"></audio>
                                <a href="${url}" download="dialogue_${index}.mp3" class="btn" style="width:auto; padding: 5px 10px; font-size: 0.8em; margin-top: 5px;">Unduh Suara</a>
                            </div>
                        `;
                    }
                    return '';
                }).join('');

                dom.podcastAudioResult.innerHTML = html + dialoguePlayerHtml;
                dom.podcastDisclaimer.style.display = 'block';

            } catch (error) {
                 console.error("Podcast Audio Generation Error:", error);
                 Swal.fire('Terjadi Kesalahan', `Gagal menghasilkan audio podcast. Detail: ${error.message}`, 'error');
            }
        }


        // --- GENERIC CONTENT GENERATOR (LYRICS, POEM, TOGEL) ---
        window.generateGeneric = async function(type) {
            const cohereKey = getApiKey('cohere');
            const promptInput = document.getElementById(`${type}-prompt`);
            const outputArea = document.getElementById(`${type}-output`);
            if (!cohereKey || !promptInput.value) {
                Swal.fire('Input Tidak Lengkap', `Harap masukkan Kunci API Cohere dan prompt.`, 'warning');
                return;
            }
            
            let preamble, message, loadingMessage;

            switch (type) {
                case 'lyrics':
                    preamble = "Anda adalah penulis lagu profesional. Anda menciptakan lirik yang puitis, emosional, dan memiliki struktur lagu yang jelas (verse, chorus, bridge).";
                    message = `Tulis lirik lagu lengkap berdasarkan tema berikut: "${promptInput.value}".`;
                    loadingMessage = "AI sedang merangkai kata menjadi lagu...";
                    break;
                case 'poem':
                    preamble = "Anda adalah seorang penyair agung dari Indonesia. Anda menulis puisi dengan diksi yang indah, majas yang kaya, dan makna yang mendalam.";
                    message = `Tulis sebuah puisi tentang: "${promptInput.value}".`;
                    loadingMessage = "AI sedang mencari inspirasi puitis...";
                    break;
                case 'togel':
                    preamble = "Anda adalah seorang analis data fiksi dan narator kreatif. Anda TIDAK PERNAH memberikan angka prediksi. Sebaliknya, Anda mengubah permintaan tentang 'pasaran' menjadi sebuah cerita pendek, interpretasi puitis, atau analisis tematik yang fiktif dan hanya untuk hiburan. Jawaban Anda selalu dalam bentuk narasi atau puisi, bukan daftar angka.";
                    message = `Buatlah sebuah interpretasi naratif atau puitis yang bersifat fiksi berdasarkan prompt berikut: "${promptInput.value}". Ingat, ini murni untuk hiburan.`;
                    loadingMessage = "AI sedang melakukan analisis fiksi...";
                    break;
            }

            outputArea.value = "Menghubungi AI...";
            const response = await makeApiCall("https://api.cohere.com/v1/chat", {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${cohereKey}` },
                body: JSON.stringify({ message, preamble }),
            }, loadingMessage);
            
            if (response) {
                const data = await response.json();
                outputArea.value = data.text;
                Swal.fire('Selesai!', 'Konten berhasil dibuat.', 'success');
            } else {
                 outputArea.value = "Gagal menghasilkan konten.";
            }
        }
    });
    </script>
</body>
</html>
