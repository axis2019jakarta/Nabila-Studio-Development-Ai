<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO (Search Engine Optimization) Tags - SIAP UNTUK DIVERIFIKASI -->
    <title>Nabila Studio - Suite AI Kreatif Terlengkap (Novel, Gambar, Podcast, Jawaban, Lirik, Puisi)</title>
    <meta name="description" content="Selamat datang di Nabila Studio, platform AI canggih untuk semua kebutuhan kreatif Anda. Hasilkan gambar dari teks, novel sekelas profesional, podcast studio, dapatkan jawaban semua soal, ciptakan lirik lagu dan puisi. Didukung oleh Cohere, Stability AI, ElevenLabs, dan lainnya.">
    <meta name="keywords" content="AI, Nabila Studio, AI Image Generator, AI Novel Writer, Podcast Generator, AI Penjawab Soal, Generator Lirik, Generator Puisi, Beli Kunci API, Cohere, Stability AI, ElevenLabs, Pixabay, Penulis, Podcaster, Kreator, Kecerdasan Buatan">
    <meta name="author" content="Nabila Studio Development">
    <meta name="robots" content="index, follow">

    <!-- Favicon -->
    <link rel="icon" href="https://img.icons8.com/fluency/48/prototyping-process.png" type="image/png">

    <!-- Google Fonts & Font Awesome Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Orbitron:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SweetAlert2 for beautiful pop-ups -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --bg-dark: #10101a;
            --bg-light: #1d1d2b;
            --sidebar-bg: #151521;
            --primary-glow: #a855f7;
            --secondary-glow: #00e1ff;
            --accent-glow: #ff55a5;
            --text-light: #f0f0f0;
            --text-dark: #a0a0b0;
            --border-color: rgba(255, 255, 255, 0.1);
            --warning-color: #ffc107;
            --success-color: #28a745;
            --danger-color: #dc3545;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            background-image: radial-gradient(circle at 1% 1%, var(--primary-glow), transparent 30%),
                              radial-gradient(circle at 99% 99%, var(--secondary-glow), transparent 30%),
                              radial-gradient(circle at 50% 50%, var(--accent-glow), transparent 40%);
            background-attachment: fixed;
            overflow-x: hidden;
        }

        .info-ticker {
            background-color: var(--primary-glow); color: white; padding: 0.5rem;
            text-align: center; font-weight: 600; font-size: 0.9em;
            position: fixed; top: 0; width: 100%; z-index: 1002;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }

        .page-wrapper { display: flex; padding-top: 40px; }
        
        .sidebar {
            width: 260px; background-color: var(--sidebar-bg); position: fixed;
            top: 40px; left: 0; height: calc(100vh - 40px); padding: 1.5rem 1rem;
            border-right: 1px solid var(--border-color); display: flex;
            flex-direction: column; z-index: 1001; transition: transform 0.3s ease-in-out;
        }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .sidebar-header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 1.5em;
            background: linear-gradient(90deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .sidebar-header .close-btn { font-size: 1.5rem; color: var(--text-dark); cursor: pointer; display: none; }
        
        .sidebar-nav { overflow-y: auto; }
        .sidebar-nav a {
            display: flex; align-items: center; padding: 1rem; margin-bottom: 0.5rem;
            color: var(--text-dark); text-decoration: none; border-radius: 8px;
            font-weight: 600; transition: all 0.3s ease;
        }
        .sidebar-nav a i { width: 30px; font-size: 1.2em; margin-right: 1rem; }
        .sidebar-nav a:hover { background-color: var(--bg-light); color: var(--text-light); }
        .sidebar-nav a.active { background-color: var(--bg-light); color: var(--text-light); box-shadow: 0 0 15px var(--primary-glow); }

        .main-content-area { margin-left: 260px; width: calc(100% - 260px); padding: 2rem; animation: fadeIn 1s ease-out; position: relative;}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .menu-toggle {
            display: none; position: fixed; top: 55px; left: 15px;
            background-color: var(--bg-light); color: var(--text-light);
            border: 1px solid var(--border-color); border-radius: 50%;
            width: 45px; height: 45px; font-size: 1.2rem;
            justify-content: center; align-items: center;
            cursor: pointer; z-index: 1002;
        }

        .page { display: none; }
        .page.active { display: block; animation: contentFadeIn 0.5s; }
        @keyframes contentFadeIn { from { opacity: 0; } to { opacity: 1; } }

        .page-header { margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .page-header h2 { font-size: 2.2em; font-weight: 700; }
        .page-header p { color: var(--text-dark); }
        
        .form-section { background-color: var(--bg-light); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; border: 1px solid var(--border-color); }
        .form-section h3 { font-size: 1.5em; margin-bottom: 1rem; border-left: 4px solid var(--primary-glow); padding-left: 10px; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark); }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; padding: 0.8rem; background-color: var(--bg-dark); border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-light); font-size: 1em; transition: all 0.3s ease;
        }
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus { outline: none; border-color: var(--secondary-glow); box-shadow: 0 0 10px var(--secondary-glow); }
        textarea { resize: vertical; min-height: 120px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
        .btn {
            display: inline-block; padding: 1rem; font-size: 1.2em; font-weight: 700; text-align: center;
            border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
        }
        .btn-primary { background: linear-gradient(90deg, var(--primary-glow), var(--accent-glow)); color: white; width: 100%;}
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); }
        .btn:disabled { background: var(--text-dark); cursor: not-allowed; transform: translateY(0); box-shadow: none; }

        .output-pane { margin-top: 2rem; }
        .output-pane h3 { font-size: 1.5em; margin-bottom: 1rem; border-left: 4px solid var(--secondary-glow); padding-left: 10px; }
        .output-area { width: 100%; min-height: 400px; background-color: #10101a; color: #f0f0f0; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; font-size: 1.1em; line-height: 1.6; }
        
        #image-output-area {
            display: flex; justify-content: center; align-items: center;
            width: 100%; min-height: 400px; background-color: #10101a;
            border: 1px solid var(--border-color); border-radius: 8px;
            padding: 1rem; overflow: hidden;
        }
        #image-output-area img { max-width: 100%; max-height: 512px; height: auto; object-fit: contain; border-radius: 8px; }

        .action-buttons { display: flex; gap: 1rem; margin-top: 1rem; justify-content: flex-end; }
        .btn-secondary { background: var(--bg-light); color: var(--text-light); border: 1px solid var(--border-color); padding: 0.5rem 1rem; font-size: 0.9em; width: auto; }
        .btn-secondary:hover { border-color: var(--primary-glow); color: var(--primary-glow); }
        
        .api-status-list { list-style: none; padding: 0; }
        .api-status-list li { display: flex; justify-content: space-between; align-items: center; background: var(--bg-dark); padding: 0.8rem 1rem; border-radius: 8px; margin-bottom: 0.5rem; }
        .api-status-badge { font-weight: bold; padding: 0.3rem 0.6rem; border-radius: 5px; font-size: 0.8em; }
        .status-ok { background-color: var(--success-color); color: white; }
        .status-missing { background-color: var(--danger-color); color: white; }
        .api-status-list a { color: var(--secondary-glow); text-decoration: none; font-weight: bold; }

        .whatsapp-fab {
            position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white;
            width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 2em; text-decoration: none;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); transition: all 0.3s ease; z-index: 1001;
        }
        .whatsapp-fab:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6); }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); z-index: 1003; top: 0; height: 100vh; }
            .sidebar.open { transform: translateX(0); box-shadow: 5px 0 25px rgba(0,0,0,0.3); }
            .sidebar-header .close-btn { display: block; }
            .main-content-area { margin-left: 0; width: 100%; padding: 1.5rem; }
            .menu-toggle { display: flex; }
            .page-wrapper { padding-top: 40px; }
            .grid, .payment-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="info-ticker">
        <marquee>Selamat Datang di Nabila Studio! Platform AI Kreatif Terlengkap. Kini dengan Generator Gambar AI! Beli Kunci API Premium melalui menu 'Beli Kunci API'.</marquee>
    </div>

    <div class="page-wrapper">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1><i class="fa-solid fa-brain"></i>Nabila Studio</h1>
                <i class="fa-solid fa-times close-btn" id="close-menu"></i>
            </div>
            <div class="sidebar-nav">
                <a href="#" class="nav-link active" data-page="page-dashboard"><i class="fa-solid fa-house-chimney"></i> Dashboard</a>
                <a href="#" class="nav-link" data-page="page-image"><i class="fa-solid fa-image"></i> AI Image Generator</a>
                <a href="#" class="nav-link" data-page="page-writer"><i class="fa-solid fa-book-sparkles"></i> AI Novel Writer</a>
                <a href="#" class="nav-link" data-page="page-podcast"><i class="fa-solid fa-podcast"></i> Studio Podcast</a>
                <a href="#" class="nav-link" data-page="page-qa"><i class="fa-solid fa-question-circle"></i> AI Penjawab Soal</a>
                <a href="#" class="nav-link" data-page="page-lyrics"><i class="fa-solid fa-music"></i> Generator Lirik Lagu</a>
                <a href="#" class="nav-link" data-page="page-poem"><i class="fa-solid fa-feather-alt"></i> Generator Puisi</a>
                <a href="#" class="nav-link" data-page="page-ramalan"><i class="fa-solid fa-wand-magic"></i> Generator Ramalan</a>
                <a href="#" class="nav-link" data-page="page-payment"><i class="fa-solid fa-wallet"></i> Beli Kunci API</a>
                <a href="#" class="nav-link" data-page="page-keys"><i class="fa-solid fa-key"></i> Manajemen Kunci API</a>
                <a href="#" class="nav-link" data-page="page-about"><i class="fa-solid fa-info-circle"></i> Tentang & Kontak</a>
            </div>
        </nav>

        <main class="main-content-area">
            <div class="menu-toggle" id="menu-toggle"><i class="fa-solid fa-bars"></i></div>
            
            <div id="page-dashboard" class="page active">
                <div class="page-header"><h2>Dashboard</h2><p>Selamat datang kembali, Kreator! Inilah pusat kendali kreatif Anda.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-check-circle"></i> Status Kunci API</h3>
                    <ul class="api-status-list" id="api-status-list">
                        <!-- Status will be populated by JavaScript -->
                    </ul>
                </div>
                <div class="form-section"><h3><i class="fa-solid fa-rocket"></i> Akses Cepat</h3><div class="grid">
                    <button class="btn" onclick="navigateToPage('page-image')">Buat Gambar AI</button>
                    <button class="btn" onclick="navigateToPage('page-writer')">Mulai Menulis Novel</button>
                    <button class="btn" onclick="navigateToPage('page-podcast')">Buat Podcast AI</button>
                    <button class="btn" onclick="navigateToPage('page-keys')">Atur Kunci API</button>
                </div></div>
            </div>

            <!-- ### HALAMAN GENERATOR GAMBAR (FITUR BARU) ### -->
            <div id="page-image" class="page">
                <div class="page-header"><h2>AI Image Generator</h2><p>Ubah imajinasi Anda menjadi gambar visual yang menakjubkan.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-palette"></i> Deskripsikan Gambar Anda</h3>
                    <div class="input-group">
                        <label for="image-prompt">Prompt (Deskripsi Gambar)</label>
                        <textarea id="image-prompt" placeholder="Contoh: Seekor astronot kucing mengendarai sepeda di Mars, sinematik, detail tinggi, 4k"></textarea>
                    </div>
                    <div class="input-group">
                        <label for="image-negative-prompt">Negative Prompt (Apa yang ingin dihindari)</label>
                        <input type="text" id="image-negative-prompt" placeholder="Contoh: blur, jelek, teks, watermark, kualitas rendah">
                    </div>
                    <div class="input-group">
                        <label for="image-style">Gaya Gambar</label>
                        <select id="image-style">
                            <option value="cinematic">Cinematic</option>
                            <option value="photographic">Photographic</option>
                            <option value="digital-art">Digital Art</option>
                            <option value="anime">Anime</option>
                            <option value="fantasy-art">Fantasy Art</option>
                            <option value="isometric">Isometric</option>
                            <option value="pixel-art">Pixel Art</option>
                            <option value="3d-model">3D Model</option>
                        </select>
                    </div>
                    <button id="generate-image-btn" class="btn btn-primary" onclick="generateImage()"><i class="fa-solid fa-image"></i> Buat Gambar!</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-image"></i> Hasil Gambar</h3>
                    <div id="image-output-area">
                        <p style="color: var(--text-dark);">Gambar yang Anda buat akan muncul di sini...</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="download-image-btn" style="display: none;" onclick="downloadImage()"><i class="fa-solid fa-download"></i> Unduh Gambar</button>
                    </div>
                </div>
            </div>

            <div id="page-writer" class="page">
                <!-- Content as before, unchanged -->
            </div>
            
            <div id="page-podcast" class="page">
                 <!-- Content as before, unchanged -->
            </div>
            
            <div id="page-qa" class="page">
                <div class="page-header"><h2>AI Penjawab Soal</h2><p>Punya pertanyaan? Tanyakan apa saja, dari soal sekolah hingga pengetahuan umum.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-keyboard"></i> Masukkan Pertanyaan Anda</h3>
                    <div class="input-group">
                        <label for="qa-prompt">Ketik pertanyaan Anda di sini. Berikan konteks jika diperlukan.</label>
                        <textarea id="qa-prompt" placeholder="Contoh: Jelaskan proses fotosintesis secara detail. atau Siapakah penemu bola lampu?"></textarea>
                    </div>
                    <button id="qa-btn" class="btn btn-primary" onclick="generateGeneric('qa')"><i class="fa-solid fa-brain-circuit"></i> Dapatkan Jawaban</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-file-alt"></i> Jawaban dari AI</h3>
                    <textarea id="qa-output" class="output-area" readonly placeholder="Jawaban akan muncul di sini..."></textarea>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="copyToClipboard('qa-output')"><i class="fa-solid fa-copy"></i> Salin Teks</button>
                        <button class="btn btn-secondary" onclick="downloadTextFile('qa-output', 'Jawaban_AI.txt')"><i class="fa-solid fa-download"></i> Unduh (.txt)</button>
                    </div>
                </div>
            </div>

            <div id="page-lyrics" class="page">
                <div class="page-header"><h2>Generator Lirik Lagu</h2><p>Ciptakan lirik yang puitis dan emosional dari ide Anda.</p></div>
                 <div class="form-section">
                    <h3><i class="fa-solid fa-lightbulb"></i> Tema Lagu Anda</h3>
                    <div class="input-group">
                        <label for="lyrics-prompt">Jelaskan tema, genre, dan perasaan yang ingin Anda sampaikan dalam lagu.</label>
                        <textarea id="lyrics-prompt" placeholder="Contoh: Lagu pop ballad tentang kerinduan pada sahabat lama, lagu rock tentang semangat pantang menyerah..."></textarea>
                    </div>
                    <button id="lyrics-btn" class="btn btn-primary" onclick="generateGeneric('lyrics')"><i class="fa-solid fa-microphone-alt"></i> Buat Lirik!</button>
                </div>
                <div class="output-pane">
                    <h3><i class="fa-solid fa-file-music"></i> Hasil Lirik</h3>
                    <textarea id="lyrics-output" class="output-area" readonly placeholder="Lirik lagu akan muncul di sini..."></textarea>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="copyToClipboard('lyrics-output')"><i class="fa-solid fa-copy"></i> Salin Teks</button>
                        <button class="btn btn-secondary" onclick="downloadTextFile('lyrics-output', 'Lirik_Lagu.txt')"><i class="fa-solid fa-download"></i> Unduh (.txt)</button>
                    </div>
                </div>
            </div>

            <div id="page-poem" class="page">
                 <!-- Unchanged -->
            </div>

            <div id="page-ramalan" class="page">
                <!-- Unchanged -->
            </div>
            
            <div id="page-payment" class="page">
                 <!-- Unchanged -->
            </div>

            <div id="page-keys" class="page">
                 <div class="page-header"><h2>Manajemen Kunci API</h2><p>Masukkan semua kunci API Anda di sini untuk mengaktifkan semua fitur.</p></div>
                <div class="form-section">
                    <h3><i class="fa-solid fa-key"></i> Kunci API Anda</h3>
                     <div class="grid">
                        <div class="input-group">
                            <label for="cohere-key">Kunci API Cohere (Untuk Teks: Novel, Soal, dll)</label>
                            <input type="password" id="cohere-key" placeholder="Wajib untuk semua fitur teks">
                        </div>
                        <div class="input-group">
                            <label for="stability-key">Kunci API Generator Gambar (mis. Stability AI)</label>
                            <input type="password" id="stability-key" placeholder="Wajib untuk fitur Generator Gambar">
                        </div>
                        <div class="input-group">
                            <label for="elevenlabs-key">Kunci API ElevenLabs (Untuk Suara Podcast)</label>
                            <input type="password" id="elevenlabs-key" placeholder="Wajib untuk generasi suara podcast">
                        </div>
                         <div class="input-group">
                            <label for="pixabay-key">Kunci API Pixabay (Untuk Musik Latar Podcast)</label>
                            <input type="password" id="pixabay-key" placeholder="Opsional, untuk musik latar">
                        </div>
                     </div>
                     <button class="btn" id="save-keys-btn" style="width: auto; padding: 0.8rem 1.5rem;"><i class="fa-solid fa-save"></i> Simpan Semua Kunci</button>
                </div>
            </div>
            
            <div id="page-about" class="page">
                <!-- Unchanged -->
            </div>

        </main>
    </div>

    <a href="https://wa.me/6285810526151?text=Halo%20Admin%20Nabila%20Studio" target="_blank" class="whatsapp-fab"><i class="fab fa-whatsapp"></i></a>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- GLOBAL DOM ELEMENTS ---
        const dom = {
            navLinks: document.querySelectorAll('.nav-link'),
            sidebar: document.getElementById('sidebar'),
            menuToggle: document.getElementById('menu-toggle'),
            closeMenu: document.getElementById('close-menu'),
            apiStatusList: document.getElementById('api-status-list'),
            
            // API Keys
            cohereKeyInput: document.getElementById('cohere-key'),
            stabilityKeyInput: document.getElementById('stability-key'),
            elevenlabsKeyInput: document.getElementById('elevenlabs-key'),
            pixabayKeyInput: document.getElementById('pixabay-key'),
            saveKeysBtn: document.getElementById('save-keys-btn'),
            
            // Payment
            paymentForm: document.getElementById('payment-form'),
            paymentProofInput: document.getElementById('payment-proof'),
            imagePreview: document.getElementById('image-preview'),

            // Image Generator
            imageOutputArea: document.getElementById('image-output-area'),
            downloadImageBtn: document.getElementById('download-image-btn'),
            generateImageBtn: document.getElementById('generate-image-btn'),
        };

        // --- INITIALIZATION ---
        loadApiKeys();
        updateDashboardStatus();
        
        // --- EVENT LISTENERS ---
        dom.navLinks.forEach(link => link.addEventListener('click', e => { 
            e.preventDefault(); 
            navigateToPage(link.dataset.page, link);
            if (window.innerWidth <= 992) {
                dom.sidebar.classList.remove('open');
            }
        }));
        dom.saveKeysBtn.addEventListener('click', () => {
            saveApiKeys();
            updateDashboardStatus();
        });
        dom.menuToggle.addEventListener('click', () => dom.sidebar.classList.add('open'));
        dom.closeMenu.addEventListener('click', () => dom.sidebar.classList.remove('open'));
        
        // Conditional listeners for pages that exist
        if (dom.paymentProofInput) {
            dom.paymentProofInput.addEventListener('change', handleImagePreview);
        }
        if (dom.paymentForm) {
            dom.paymentForm.addEventListener('submit', handlePaymentConfirmation);
        }

        // --- UTILITY: Copy & Download ---
        window.copyToClipboard = function(elementId) { /* Unchanged */ };
        window.downloadTextFile = function(elementId, defaultFilename) { /* Unchanged */ };

        // --- NAVIGATION & UI ---
        window.navigateToPage = function(pageId, clickedLink = null) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if(targetPage) targetPage.classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const linkToActivate = clickedLink || document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (linkToActivate) linkToActivate.classList.add('active');
        };

        function updateDashboardStatus() {
            const keys = [
                { name: 'Cohere (Teks)', key: 'cohereApiKey', required: true },
                { name: 'Image Generator (Gambar)', key: 'stabilityApiKey', required: true },
                { name: 'ElevenLabs (Suara)', key: 'elevenlabsApiKey', required: true },
                { name: 'Pixabay (Musik)', key: 'pixabayApiKey', required: false },
            ];
            
            dom.apiStatusList.innerHTML = ''; // Clear list

            keys.forEach(item => {
                const keyExists = !!localStorage.getItem(item.key);
                const statusClass = keyExists ? 'status-ok' : 'status-missing';
                const statusText = keyExists ? 'TERPASANG' : 'KOSONG';
                let html = `
                    <li>
                        <span><i class="fa-solid fa-key"></i> ${item.name} ${item.required ? '' : '(Opsional)'}</span>
                        ${keyExists ? `<span class="api-status-badge ${statusClass}">${statusText}</span>` : `<a href="#" onclick="navigateToPage('page-keys')">Isi Kunci <i class="fa-solid fa-arrow-right"></i></a>`}
                    </li>`;
                dom.apiStatusList.insertAdjacentHTML('beforeend', html);
            });
        }


        // --- KEY MANAGEMENT ---
        function loadApiKeys() {
            dom.cohereKeyInput.value = localStorage.getItem('cohereApiKey') || '';
            dom.stabilityKeyInput.value = localStorage.getItem('stabilityApiKey') || '';
            dom.elevenlabsKeyInput.value = localStorage.getItem('elevenlabsApiKey') || '';
            dom.pixabayKeyInput.value = localStorage.getItem('pixabayApiKey') || '';
        }
        function saveApiKeys() {
            localStorage.setItem('cohereApiKey', dom.cohereKeyInput.value);
            localStorage.setItem('stabilityApiKey', dom.stabilityKeyInput.value);
            localStorage.setItem('elevenlabsApiKey', dom.elevenlabsKeyInput.value);
            localStorage.setItem('pixabayApiKey', dom.pixabayKeyInput.value);
            Swal.fire('Sukses', 'Semua Kunci API telah disimpan di browser Anda.', 'success');
        }
        function getApiKey(service) {
            const keyMap = {
                'cohere': 'cohereApiKey',
                'stability': 'stabilityApiKey',
                'elevenlabs': 'elevenlabsApiKey',
                'pixabay': 'pixabayApiKey'
            };
            const keyName = keyMap[service];
            const key = localStorage.getItem(keyName);
            if (!key) {
                Swal.fire({
                    icon: 'error',
                    title: 'Kunci API Hilang',
                    html: `Harap masukkan <b>Kunci API untuk ${service}</b> di halaman 'Manajemen Kunci API'.`,
                }).then(() => {
                     navigateToPage('page-keys');
                });
                return null;
            }
            return key;
        }
        
        // --- PAYMENT LOGIC --- (Unchanged)
        function handleImagePreview() { /* ... */ }
        function handlePaymentConfirmation(e) { /* ... */ }

        // --- AI IMAGE GENERATOR (NEW FEATURE) ---
        window.generateImage = async function() {
            const stabilityKey = getApiKey('stability');
            const prompt = document.getElementById('image-prompt').value;
            const negative_prompt = document.getElementById('image-negative-prompt').value;
            const style_preset = document.getElementById('image-style').value;
            
            if (!stabilityKey || !prompt) {
                Swal.fire('Input Tidak Lengkap', 'Harap masukkan Kunci API Generator Gambar dan deskripsi gambar.', 'warning');
                return;
            }

            dom.generateImageBtn.disabled = true;
            dom.downloadImageBtn.style.display = 'none';
            dom.imageOutputArea.innerHTML = ''; // Clear previous image
            Swal.fire({ title: 'Sedang Menggambar...', html: 'AI sedang mengubah teks menjadi gambar. Mohon tunggu...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            try {
                // NOTE: This uses the Stability AI API endpoint structure.
                const response = await fetch("https://api.stability.ai/v1/generation/stable-diffusion-v1-6/text-to-image", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${stabilityKey}`
                    },
                    body: JSON.stringify({
                        text_prompts: [{ text: prompt }, { text: negative_prompt, weight: -1 }],
                        cfg_scale: 7,
                        height: 512,
                        width: 512,
                        steps: 30,
                        samples: 1,
                        style_preset: style_preset,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Error ${response.status}: ${errorData.message || 'Unknown API error'}`);
                }

                const data = await response.json();
                const image = data.artifacts[0];
                const base64Image = `data:image/png;base64,${image.base64}`;

                dom.imageOutputArea.innerHTML = `<img src="${base64Image}" alt="Generated Image">`;
                dom.downloadImageBtn.style.display = 'inline-block';
                dom.downloadImageBtn.dataset.base64 = base64Image; // Store base64 data for download
                
                Swal.fire('Selesai!', 'Gambar berhasil dibuat.', 'success');

            } catch (error) {
                console.error("Image Generation Error:", error);
                Swal.fire('Terjadi Kesalahan', `Gagal membuat gambar. Detail: ${error.message}`, 'error');
                dom.imageOutputArea.innerHTML = `<p style="color: var(--danger-color);">Gagal memuat gambar. Periksa konsol untuk detail error.</p>`;
            } finally {
                dom.generateImageBtn.disabled = false;
            }
        }

        window.downloadImage = function() {
            const base64Image = dom.downloadImageBtn.dataset.base64;
            if (!base64Image) return;
            const link = document.createElement('a');
            link.href = base64Image;
            link.download = `nabila-studio-image-${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- GENERIC CONTENT GENERATOR (QA, Lyrics, Poem, Ramalan) ---
        window.generateGeneric = async function(type) {
            const cohereKey = getApiKey('cohere');
            const promptInput = document.getElementById(`${type}-prompt`);
            const outputArea = document.getElementById(`${type}-output`);
            const button = document.getElementById(`${type}-btn`);

            if (!cohereKey || !promptInput.value) {
                Swal.fire('Input Tidak Lengkap', `Harap masukkan Kunci API Cohere dan prompt/pertanyaan.`, 'warning');
                return;
            }
            
            let preamble, message, loadingMessage;

            // Switch case remains the same
            switch (type) {
                case 'qa':
                    preamble = "..."; message = `Jawab pertanyaan berikut: "${promptInput.value}"`; loadingMessage = "..."; break;
                // other cases unchanged
            }
            
            button.disabled = true;
            outputArea.value = "Menghubungi AI...";
            Swal.fire({ title: 'Sedang Memproses...', html: loadingMessage, allowOutsideClick: false, didOpen: () => Swal.showLoading() });

            try {
                // Fetch logic is the same
                const response = await fetch("https://api.cohere.com/v1/chat", { /* ... */ });
                // ...
                const data = await response.json();
                outputArea.value = data.text;
                Swal.fire('Selesai!', 'Konten berhasil dibuat.', 'success');
            } catch (error) {
                // Error handling is the same
            } finally {
                button.disabled = false;
            }
        }
        
        // --- Dummy functions to avoid breaking the provided HTML structure ---
        // You can paste the full JS logic for these from previous versions if needed.
        if (!window.handleImagePreview) window.handleImagePreview = function() { console.log("Image Preview handler"); };
        if (!window.handlePaymentConfirmation) window.handlePaymentConfirmation = function(e) { e.preventDefault(); console.log("Payment handler"); };
        if (!window.copyToClipboard) window.copyToClipboard = function() { console.log("Copy handler"); };
        if (!window.downloadTextFile) window.downloadTextFile = function() { console.log("Download handler"); };
    });
    </script>
</body>
</html>
